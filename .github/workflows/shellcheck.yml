name: ShellCheck & Unit Tests

on:
  push:
    branches: [main]
  pull_request:
    branches: [main]

jobs:
  shellcheck:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Install ShellCheck
        run: sudo apt-get update && sudo apt-get install -y shellcheck
      - name: Run ShellCheck on entry scripts
        run: shellcheck -s bash -S warning setup-k8s.sh cleanup-k8s.sh
      - name: Run ShellCheck on common modules
        run: shellcheck -s bash -S warning common/*.sh
      - name: Run ShellCheck on distro modules
        run: shellcheck -s bash -S warning distros/**/*.sh
      - name: Run ShellCheck on test runner
        run: shellcheck -s bash -S warning test/run-test.sh

  unit-tests:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Run unit tests
        run: bash test/unit/run_unit_tests.sh
