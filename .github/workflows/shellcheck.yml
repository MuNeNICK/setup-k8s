name: ShellCheck & Unit Tests

on:
  push:
    branches: [main]
  pull_request:
    branches: [main]

permissions:
  contents: read

jobs:
  shellcheck:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@34e114876b0b11c390a56381ad16ebd13914f8d5 # v4.3.1
      - name: Install ShellCheck
        run: sudo apt-get update && sudo apt-get install -y shellcheck
      - name: Run ShellCheck on entry scripts
        run: shellcheck -s sh -S warning setup-k8s.sh cleanup-k8s.sh
      - name: Run ShellCheck on common modules
        run: shellcheck -s sh -S warning common/*.sh
      - name: Run ShellCheck on distro modules
        run: shellcheck -s sh -S warning distros/**/*.sh
      - name: Run ShellCheck on test runners
        run: shellcheck -s bash -S warning test/run-e2e-tests.sh test/run-ha-test.sh test/run-deploy-test.sh test/run-backup-test.sh test/run-unit-tests.sh

  unit-tests:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@34e114876b0b11c390a56381ad16ebd13914f8d5 # v4.3.1
      - name: Run unit tests
        run: bash test/run-unit-tests.sh
